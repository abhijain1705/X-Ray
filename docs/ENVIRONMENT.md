# Environment Variables Reference

Complete reference of all environment variables required by X-Ray components.

## Quick Reference

```bash
# Backend (.env.local in server/)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=eyJhbGc...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...
CLERK_SECRET_KEY=sk_test_...
PORT=4000
NODE_ENV=development

# Dashboard (.env.local in frontend/)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_API_BASE_URL=http://localhost:4000

# SDK (use environment or runtime config)
XRAY_API_KEY=xr_550e8400-e29b-41d4-a716-446655440000
XRAY_ENDPOINT=http://localhost:4000
```

---

## Backend (server/)

### Required Variables

#### `SUPABASE_URL`

- **Type:** String (URL)
- **Example:** `https://abc123.supabase.co`
- **Where to find:** Supabase Dashboard > Settings > API
- **Purpose:** Database connection URL
- **Required for:** Database operations

#### `SUPABASE_ANON_KEY` or `SUPABASE_SERVICE_ROLE_KEY`

- **Type:** String (API key)
- **Example:** `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
- **Where to find:** Supabase Dashboard > Settings > API
- **Purpose:** Authenticate with Supabase
- **Recommendation:** Use `SUPABASE_SERVICE_ROLE_KEY` for backend (full access)
- **Required for:** Supabase client initialization

#### `CLERK_SECRET_KEY`

- **Type:** String (API key)
- **Example:** `sk_test_abc123...`
- **Where to find:** Clerk Dashboard > API Keys > Secret Key
- **Purpose:** User authentication and sync
- **Required for:** User sync endpoint

### Optional Variables

#### `PORT`

- **Type:** Integer
- **Default:** `4000`
- **Example:** `5000`
- **Purpose:** Server listen port
- **Optional:** Yes, defaults to 4000

#### `NODE_ENV`

- **Type:** String
- **Options:** `development`, `production`
- **Default:** `production`
- **Purpose:** Logging and optimization level
- **Optional:** Yes

#### `LOG_LEVEL`

- **Type:** String
- **Options:** `debug`, `info`, `warn`, `error`
- **Default:** `info`
- **Purpose:** Logger verbosity
- **Optional:** Yes (not yet implemented)

---

## Dashboard (frontend/)

### Required Variables

#### `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`

- **Type:** String (API key, safe to expose)
- **Example:** `pk_test_abc123...`
- **Where to find:** Clerk Dashboard > API Keys > Publishable Key
- **Purpose:** Clerk authentication on frontend
- **Required for:** Sign-in and authentication
- **Note:** `NEXT_PUBLIC_` prefix means it's embedded in frontend bundle

#### `CLERK_SECRET_KEY`

- **Type:** String (API key, keep secret)
- **Example:** `sk_test_abc123...`
- **Where to find:** Clerk Dashboard > API Keys > Secret Key
- **Purpose:** Server-side Clerk operations
- **Required for:** User sync, webhook verification

#### `NEXT_PUBLIC_API_BASE_URL`

- **Type:** String (URL)
- **Example:** `http://localhost:4000` (dev) or `https://api.example.com` (prod)
- **Purpose:** Backend URL for API calls
- **Required for:** Calls to backend endpoints
- **Note:** `NEXT_PUBLIC_` prefix means it's visible in frontend

### Optional Variables

#### `NEXT_PUBLIC_APP_ENV`

- **Type:** String
- **Options:** `development`, `production`
- **Default:** Auto-detected
- **Purpose:** UI mode (debug info, etc.)
- **Optional:** Yes

---

## SDK

### Configuration (Runtime)

The SDK can be configured at runtime without environment variables:

```typescript
import XRaySDK from "@xray/sdk";

const xray = new XRaySDK({
  apiKey: "xr_...", // Required
  appId: "my-app", // Required
  pipeline: "my-pipeline", // Required
  environment: "prod", // Optional
});
```

### Environment Variables (Optional)

The SDK reads these if not provided at runtime:

#### `XRAY_API_KEY`

- **Type:** String (API key)
- **Example:** `xr_550e8400-e29b-41d4-a716-446655440000`
- **Where to find:** Generated by backend `/apps` endpoint
- **Purpose:** SDK authentication to backend
- **Used by:** SDK for snapshot ingestion
- **Optional:** Yes, can be passed at runtime

#### `XRAY_ENDPOINT`

- **Type:** String (URL)
- **Default:** `http://localhost:4000`
- **Example:** `https://api.example.com` (production)
- **Purpose:** Backend URL for snapshot posting
- **Used by:** SDK to send snapshots
- **Optional:** Yes, defaults to localhost

---

## Environment-Specific Configurations

### Development

```bash
# Backend
NODE_ENV=development
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
CLERK_SECRET_KEY=sk_test_...
PORT=4000

# Dashboard
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_API_BASE_URL=http://localhost:4000

# SDK
XRAY_API_KEY=xr_...
XRAY_ENDPOINT=http://localhost:4000
```

### Production

```bash
# Backend
NODE_ENV=production
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
CLERK_SECRET_KEY=sk_live_...
PORT=4000

# Dashboard
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_...
CLERK_SECRET_KEY=sk_live_...
NEXT_PUBLIC_API_BASE_URL=https://api.example.com

# SDK (in your app)
XRAY_API_KEY=xr_...
XRAY_ENDPOINT=https://api.example.com
```

---

## How to Set Environment Variables

### Local Development (.env.local)

**Backend:**

```bash
cd server
cat > .env.local << EOF
SUPABASE_URL=https://abc123.supabase.co
SUPABASE_ANON_KEY=eyJhbGc...
CLERK_SECRET_KEY=sk_test_...
NODE_ENV=development
PORT=4000
EOF
```

**Dashboard:**

```bash
cd frontend
cat > .env.local << EOF
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_API_BASE_URL=http://localhost:4000
EOF
```

### Production (Cloud Hosting)

**Vercel (Dashboard):**

1. Go to Project Settings > Environment Variables
2. Add each variable
3. Redeploy

**Railway:**

1. Go to Variables
2. Add each key-value pair
3. Auto-redeployed

**Docker:**

```bash
docker run -e SUPABASE_URL=... -e CLERK_SECRET_KEY=... xray-backend
```

**Traditional VPS:**

```bash
# /etc/systemd/system/xray.service
Environment="SUPABASE_URL=..."
Environment="CLERK_SECRET_KEY=..."
```

---

## Getting Values from External Services

### Supabase

1. Go to [app.supabase.com](https://app.supabase.com)
2. Select your project
3. Go to **Settings > API**
4. Copy:
   - **Project URL** → `SUPABASE_URL`
   - **anon public** → `SUPABASE_ANON_KEY`
   - **service_role secret** → `SUPABASE_SERVICE_ROLE_KEY`

### Clerk

1. Go to [dashboard.clerk.com](https://dashboard.clerk.com)
2. Select your application
3. Go to **API Keys**
4. Copy:
   - **Publishable Key** → `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
   - **Secret Key** → `CLERK_SECRET_KEY`

### X-Ray Backend (SDK)

1. Run `/apps` endpoint to create an app:
   ```bash
   curl -X POST http://localhost:4000/apps \
     -H "Content-Type: application/json" \
     -d '{"userId": "test", "name": "My App"}'
   ```
2. Copy `api_key` from response → `XRAY_API_KEY`

---

## Security Best Practices

### Never

- ❌ Hardcode secrets in code
- ❌ Commit `.env.local` to Git
- ❌ Share API keys publicly
- ❌ Use test keys in production
- ❌ Log secrets to console

### Always

- ✅ Use `.env.local` (local development)
- ✅ Use cloud secrets manager (production)
- ✅ Rotate keys regularly
- ✅ Use different keys per environment
- ✅ Enable 2FA on accounts that generate keys
- ✅ Restrict API key permissions (least privilege)

### .gitignore

Ensure `.env.local` is ignored:

```bash
# .gitignore
.env.local
.env.*.local
```

---

## Troubleshooting

### "Cannot find SUPABASE_URL"

- Check `.env.local` exists
- Verify variable name is correct (case-sensitive)
- Restart server after changing env vars

### "Invalid API key"

- Verify the key format (should start with `xr_`)
- Check the key exists in Supabase `apps` table
- Try creating a new app via `/apps` endpoint

### "Clerk key is invalid"

- Use **Publishable Key** for `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
- Use **Secret Key** for `CLERK_SECRET_KEY`
- Verify you're not mixing test and live keys

### "Connection refused" (Supabase)

- Verify `SUPABASE_URL` is correct
- Check your Supabase project is active (not paused)
- Test connectivity: `curl $SUPABASE_URL`

---

## Environment Variable Checklist

### Backend Setup

- [ ] `SUPABASE_URL` set and correct
- [ ] `SUPABASE_ANON_KEY` or `SUPABASE_SERVICE_ROLE_KEY` set
- [ ] `CLERK_SECRET_KEY` set
- [ ] `PORT` configured (or using default 4000)
- [ ] `.env.local` created and in `.gitignore`

### Dashboard Setup

- [ ] `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` set
- [ ] `CLERK_SECRET_KEY` set (server-side)
- [ ] `NEXT_PUBLIC_API_BASE_URL` points to backend
- [ ] `.env.local` created and in `.gitignore`

### SDK Setup

- [ ] Created app via backend `/apps` endpoint
- [ ] Got `api_key` from response
- [ ] Set `XRAY_API_KEY` (or pass at runtime)
- [ ] Verified backend is running

---

## Template Files

See these files for environment variable templates:

- [server/.env.example](../server/.env.example)
- [frontend/.env.example](../frontend/.env.example)

Copy and fill in:

```bash
cp server/.env.example server/.env.local
# Edit with your values
```

---

## Support

- **Questions about env vars?** See [docs/SETUP.md](SETUP.md#step-5-configure-environment-variables)
- **Can't find a value?** Check [Troubleshooting](#troubleshooting) section
- **Still stuck?** [Open an issue](https://github.com/abhijain1705/x-ray/issues)

---

**Last Updated:** January 2025  
**Version:** 0.1
